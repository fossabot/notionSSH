# ì‚¬ìš©ìž ì ‘ê·¼ ì œì–´ (Access Control)

## Language / ì–¸ì–´
- [ðŸ‡°ðŸ‡· í•œêµ­ì–´](access.md)
- [ðŸ‡ºðŸ‡¸ English](access_en.md)

---

NotionSSHëŠ” ì„¸ë¶€ì ì¸ ì‚¬ìš©ìž ì ‘ê·¼ ì œì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. íŠ¹ì • ì‚¬ìš©ìžê°€ ì‹¤í–‰í•  ìˆ˜ ìžˆëŠ” ëª…ë ¹ì–´ë¥¼ ì œí•œí•˜ê³ , ê´€ë¦¬ìžì™€ ì¼ë°˜ ì‚¬ìš©ìžë¥¼ êµ¬ë¶„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

## ì ‘ê·¼ ì œì–´ íŒŒì¼ êµ¬ì¡°

ì ‘ê·¼ ì œì–´ ì„¤ì •ì€ `.notionSSH/access.json` íŒŒì¼ì— ì €ìž¥ë©ë‹ˆë‹¤. NotionSSHë¥¼ ì²˜ìŒ ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ ì„¤ì •ì´ ìžë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

### ê¸°ë³¸ ì„¤ì • íŒŒì¼ ì˜ˆì‹œ
```json
{
  "emails": {
    "user@example.com": "restricted_user",
    "admin@example.com": "power_user"
  },
  "perm_manager": [
    "manager@example.com",
    "super@example.com"
  ],
  "perms": {
    "default": {
      "allow": ["*"],
      "deny": []
    },
    "restricted_user": {
      "allow": ["ls", "pwd", "whoami", "date"],
      "deny": ["rm", "sudo", "su"]
    },
    "power_user": {
      "allow": ["*"],
      "deny": ["rm -rf", "sudo rm"]
    }
  }
}
```

## ì„¤ì • êµ¬ì„± ìš”ì†Œ

### 1. emails
íŠ¹ì • ì‚¬ìš©ìž ì´ë©”ì¼ì„ ê¶Œí•œ ê·¸ë£¹(role)ì— ë§¤í•‘í•©ë‹ˆë‹¤.
- **í‚¤**: ì‚¬ìš©ìž ì´ë©”ì¼ ì£¼ì†Œ
- **ê°’**: ê¶Œí•œ ê·¸ë£¹ ì´ë¦„ (permsì— ì •ì˜ëœ ê·¸ë£¹)
- ì„¤ì •ë˜ì§€ ì•Šì€ ì‚¬ìš©ìžëŠ” ìžë™ìœ¼ë¡œ "default" ê·¸ë£¹ì— í• ë‹¹ë©ë‹ˆë‹¤

### 2. perm_manager
ê´€ë¦¬ìž ëª©ë¡ìž…ë‹ˆë‹¤. ì—¬ê¸°ì— ë“±ë¡ëœ ì‚¬ìš©ìžëŠ” ëª¨ë“  ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
- ê¶Œí•œ ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ë©° í•­ìƒ ëª¨ë“  ëª…ë ¹ì–´ ì‹¤í–‰ ê°€ëŠ¥
- ë³´ì•ˆìƒ ì¤‘ìš”í•œ ì—­í• ì´ë¯€ë¡œ ì‹ ì¤‘ížˆ ì„¤ì •í•˜ì„¸ìš”

### 3. perms
ê¶Œí•œ ê·¸ë£¹ë³„ ê·œì¹™ì„ ì •ì˜í•©ë‹ˆë‹¤.
- **ê·¸ë£¹ëª…**: ê¶Œí•œ ê·¸ë£¹ì˜ ì´ë¦„ (emailsì—ì„œ ì°¸ì¡°)
- **allow**: í—ˆìš©ëœ ëª…ë ¹ì–´ ëª©ë¡
- **deny**: ê¸ˆì§€ëœ ëª…ë ¹ì–´ ëª©ë¡ (allowë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ)

## ëª…ë ¹ì–´ ë§¤ì¹­ ê·œì¹™

### ì™€ì¼ë“œì¹´ë“œ ë§¤ì¹­
- `"*"`: ëª¨ë“  ëª…ë ¹ì–´ í—ˆìš©

### ë‹¨ì¼ ëª…ë ¹ì–´ ë§¤ì¹­
```json
{
  "allow": ["ls", "pwd", "date"]
}
```
ëª…ë ¹ì–´ì˜ ì²« ë²ˆì§¸ í† í°ë§Œ ë¹„êµí•©ë‹ˆë‹¤ (ëŒ€ì†Œë¬¸ìž ë¬´ì‹œ):
- `!(ls -la)` â†’ `ls` ë§¤ì¹­ âœ“
- `!(pwd)` â†’ `pwd` ë§¤ì¹­ âœ“

### ëª…ë ¹ì–´ ì „ì²´ ë§¤ì¹­
```json
{
  "deny": ["rm -rf", "sudo rm"]
}
```
ê³µë°±ì´ í¬í•¨ëœ ê²½ìš° ëª…ë ¹ì–´ ì „ì²´ì™€ ì ‘ë‘ì‚¬ ë§¤ì¹­:
- `!(rm -rf /tmp)` â†’ `rm -rf` ë§¤ì¹­ âœ“
- `!(sudo rm file.txt)` â†’ `sudo rm` ë§¤ì¹­ âœ“

## ê¶Œí•œ ì²˜ë¦¬ ìš°ì„ ìˆœìœ„

1. **ê´€ë¦¬ìž ê²€ì‚¬**: `perm_manager`ì— ë“±ë¡ëœ ì‚¬ìš©ìžëŠ” ëª¨ë“  ëª…ë ¹ì–´ ì‹¤í–‰ ê°€ëŠ¥
2. **ì‚¬ìš©ìž ê·¸ë£¹ ê²°ì •**: `emails`ì—ì„œ ì‚¬ìš©ìž ê·¸ë£¹ í™•ì¸ (ì—†ìœ¼ë©´ "default")
3. **ê±°ë¶€ ê·œì¹™ ê²€ì‚¬**: `deny` ëª©ë¡ì—ì„œ ëª…ë ¹ì–´ ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸
4. **í—ˆìš© ê·œì¹™ ê²€ì‚¬**: `allow` ëª©ë¡ì—ì„œ ëª…ë ¹ì–´ í—ˆìš© ì—¬ë¶€ í™•ì¸
5. **ê¸°ë³¸ ê±°ë¶€**: ëª…ì‹œì ìœ¼ë¡œ í—ˆìš©ë˜ì§€ ì•Šì€ ëª…ë ¹ì–´ëŠ” ê±°ë¶€

## ì„¤ì • ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ëª…ë ¹ì–´ í—ˆìš©, íŠ¹ì • ëª…ë ¹ì–´ë§Œ ì°¨ë‹¨
```json
{
  "emails": {},
  "perm_manager": ["admin@company.com"],
  "perms": {
    "default": {
      "allow": ["*"],
      "deny": ["rm -rf", "sudo", "su", "passwd"]
    }
  }
}
```

### ì˜ˆì‹œ 2: ê¸°ë³¸ì ìœ¼ë¡œ ì œí•œì , íŠ¹ì • ì‚¬ìš©ìžì—ê²Œ ì¶”ê°€ ê¶Œí•œ ë¶€ì—¬
```json
{
  "emails": {
    "devops@company.com": "devops_user",
    "intern@company.com": "readonly_user"
  },
  "perm_manager": ["admin@company.com"],
  "perms": {
    "default": {
      "allow": ["ls", "pwd", "whoami", "date", "ps"],
      "deny": []
    },
    "devops_user": {
      "allow": ["*"],
      "deny": ["rm -rf /"]
    },
    "readonly_user": {
      "allow": ["ls", "pwd", "whoami", "date"],
      "deny": ["*"]
    }
  }
}
```

### ì˜ˆì‹œ 3: ë¶€ì„œë³„ ê¶Œí•œ ê´€ë¦¬
```json
{
  "emails": {
    "dev1@company.com": "developer",
    "dev2@company.com": "developer", 
    "ops1@company.com": "operation",
    "ops2@company.com": "operation",
    "junior@company.com": "trainee"
  },
  "perm_manager": ["cto@company.com", "devops-lead@company.com"],
  "perms": {
    "default": {
      "allow": ["ls", "pwd", "whoami", "date"],
      "deny": []
    },
    "developer": {
      "allow": ["ls", "pwd", "whoami", "date", "ps", "git", "npm", "node", "python", "docker ps"],
      "deny": ["sudo", "rm -rf", "chmod", "chown"]
    },
    "operation": {
      "allow": ["*"],
      "deny": ["rm -rf /", "sudo shutdown", "sudo reboot"]
    },
    "trainee": {
      "allow": ["ls", "pwd", "whoami", "date", "echo"],
      "deny": ["*"]
    }
  }
}
```

## ì ‘ê·¼ ì œì–´ ì ìš©í•˜ê¸°

### 1ë‹¨ê³„: ì„¤ì • íŒŒì¼ ìˆ˜ì •
`.notionSSH/access.json` íŒŒì¼ì„ ì›í•˜ëŠ” ì„¤ì •ìœ¼ë¡œ íŽ¸ì§‘í•©ë‹ˆë‹¤.

### 2ë‹¨ê³„: ì„¤ì • ê²€ì¦
NotionSSH ìž¬ì‹œìž‘ ì‹œ ì„¤ì • íŒŒì¼ì´ ìžë™ìœ¼ë¡œ ê²€ì¦ë©ë‹ˆë‹¤. ë¬¸ë²• ì˜¤ë¥˜ê°€ ìžˆìœ¼ë©´ ì‹œìž‘ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.

### 3ë‹¨ê³„: ê¶Œí•œ í…ŒìŠ¤íŠ¸
- ì œí•œëœ ì‚¬ìš©ìžë¡œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë³´ê³  ê¶Œí•œì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ëŠ”ì§€ í™•ì¸
- ê¶Œí•œì´ ì—†ëŠ” ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ "ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ê¶Œí•œì´ ë¶€ì¡±í•©ë‹ˆë‹¤" ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤

## ë³´ì•ˆ ê¶Œìž¥ì‚¬í•­

### ìµœì†Œ ê¶Œí•œ ì›ì¹™
- ì‚¬ìš©ìžì—ê²Œ ì—…ë¬´ ìˆ˜í–‰ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬
- `perm_manager`ì—ëŠ” ê¼­ í•„ìš”í•œ ê´€ë¦¬ìžë§Œ ë“±ë¡
- ê¸°ë³¸ ì„¤ì •(`default`)ì„ ì œí•œì ìœ¼ë¡œ ì„¤ì •

### ì •ê¸°ì ì¸ ê¶Œí•œ ê²€í† 
- ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ìž ê¶Œí•œì„ ê²€í† í•˜ê³  ë¶ˆí•„ìš”í•œ ê¶Œí•œ ì œê±°
- í‡´ì‚¬ìž ê³„ì •ì€ ì¦‰ì‹œ `access.json`ì—ì„œ ì œê±°
- ê°ì‚¬ ë¡œê·¸ë¥¼ í†µí•´ ê¶Œí•œ ì‚¬ìš© í˜„í™© ëª¨ë‹ˆí„°ë§

### ìœ„í—˜í•œ ëª…ë ¹ì–´ ì°¨ë‹¨
ë‹¤ìŒê³¼ ê°™ì€ ìœ„í—˜í•œ ëª…ë ¹ì–´ëŠ” `deny` ëª©ë¡ì— ì¶”ê°€í•˜ëŠ” ê²ƒì„ ê¶Œìž¥í•©ë‹ˆë‹¤:
- `rm -rf`
- `sudo shutdown`
- `sudo reboot` 
- `passwd`
- `su`
- `chmod 777`
- `chown -R`

## ë¬¸ì œ í•´ê²°

### ì„¤ì • íŒŒì¼ì´ ì†ìƒëœ ê²½ìš°
- `.notionSSH/access.json` íŒŒì¼ì„ ì‚­ì œí•˜ë©´ ë‹¤ìŒ ì‹¤í–‰ ì‹œ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ìž¬ìƒì„±ë©ë‹ˆë‹¤
- ë°±ì—… íŒŒì¼ì´ ìžˆë‹¤ë©´ ë³µì› í›„ ì‚¬ìš©

### ê¶Œí•œì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°
- ì‚¬ìš©ìžê°€ `perm_manager`ì— ë“±ë¡ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸ (ê´€ë¦¬ìžëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ )
- ì´ë©”ì¼ ì£¼ì†Œê°€ ì •í™•í•œì§€ í™•ì¸ (ëŒ€ì†Œë¬¸ìžëŠ” ë¬´ì‹œí•˜ì§€ë§Œ ì •í™•í•œ ì£¼ì†Œ í•„ìš”)
- JSON ë¬¸ë²•ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸ (trailing comma, ë”°ì˜´í‘œ ë“±)

### ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€

#### "access.json missing required 'perms.default' rule"
- `perms` ê°ì²´ì— ë°˜ë“œì‹œ "default" ê·¸ë£¹ì´ ì •ì˜ë˜ì–´ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤

#### "access.json is empty"
- ì„¤ì • íŒŒì¼ì´ ë¹„ì–´ìžˆê±°ë‚˜ ê³µë°±ë§Œ ìžˆëŠ” ê²½ìš° ë°œìƒ
- íŒŒì¼ì„ ì‚­ì œí•˜ê³  ìž¬ìƒì„±í•˜ê±°ë‚˜ ì˜¬ë°”ë¥¸ JSON êµ¬ì¡°ë¡œ ìˆ˜ì •

#### JSON íŒŒì‹± ì˜¤ë¥˜
- JSON ë¬¸ë²• ì˜¤ë¥˜ ì‹œ ë°œìƒí•˜ëŠ” ë©”ì‹œì§€ë“¤
- ì˜¨ë¼ì¸ JSON ê²€ì¦ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ë²• í™•ì¸

## ëª…ë ¹ì–´ ì‹¤í–‰ í”Œë¡œìš°

```mermaid
flowchart TD
    A[ëª…ë ¹ì–´ ì‹¤í–‰ ìš”ì²­] --> B{ì‚¬ìš©ìžê°€ perm_manager?}
    B -->|Yes| C[ëª…ë ¹ì–´ ì‹¤í–‰]
    B -->|No| D[ì‚¬ìš©ìž ê·¸ë£¹ í™•ì¸]
    D --> E{deny ê·œì¹™ ë§¤ì¹­?}
    E -->|Yes| F[ê¶Œí•œ ê±°ë¶€]
    E -->|No| G{allow ê·œì¹™ ë§¤ì¹­?}
    G -->|Yes| C
    G -->|No| F
    C --> H[ê²°ê³¼ ë°˜í™˜]
    F --> I[ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€]
```